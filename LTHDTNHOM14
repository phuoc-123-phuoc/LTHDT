#include <iostream>
#include <iomanip>
#include <string.h>
#include <conio.h>
#include <stdlib.h>
#include <time.h>
#include <fstream>
using namespace std;

class HOTEN
{
		protected:
		char ho[10], tenlot[20], ten[10];
};
class MONHOC
{
		protected:
	float diemmon1, diemmon2, diemmon3, diemtb;
};
class NGAYSINH
{
		protected:
		int ngay, thang, nam;
};
class SINHVIEN:public HOTEN,public MONHOC,public NGAYSINH
{
	protected:
		char masv[10];
		char gioitinh[5];
	friend class DSSINHVIEN;
		
};
class DSSINHVIEN
{
	private:
	  SINHVIEN *a;
	  int n;
	public:
		void Nhap_kluu();
		void Nhap_luufile();
		void Docfile();
		void xuatthongtin();
		void Tim_msv();
		void tim_Ten();
		void Tim_dtb();
		void timsv_GioiTinh();
		void Tim_tuoi();
		int Dem_dtb();
		int Dem_ten();
		int Dem_tuoi();
		int Dem_gioitinh();
		void HoanVi(SINHVIEN &a, SINHVIEN &b);
		void SapXep_msv();
		void SapXep_tsv();
		void SapXep_tuoi();
		void SapXep_dtb();
		void SapXep_gt();
		void Them();
		void xoa(int &x);
		void luufile();  

};
void DSSINHVIEN::Nhap_kluu()
{
	
	cout << "\n Nhap vao so sinh vien:" << endl;
	cin >> n;
    	a = new SINHVIEN[n];
	for (int i = 0; i < n; i++)
	{
		cout << "\n nhap vao thong tinh sinh vien thu:" << i + 1;
		fflush(stdin);
		do
		{
			cout << "\n nhap vao ma so sinh vien : ";
			gets(a[i].masv);
			if (strlen(a[i].masv) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].masv) <= 0);
		do
		{
			cout << "\n nhap vao ho :";
			gets(a[i].ho);
			if (strlen(a[i].ho) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}

		} while (strlen(a[i].ho) <= 0);
		do
		{
			cout << "\n nhap vao ten lot : ";
			gets(a[i].tenlot);
			if (strlen(a[i].tenlot) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].tenlot) <= 0);
		do
		{
			cout << "\n nhap vao ten : ";
			gets(a[i].ten);
			if (strlen(a[i].ten) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].ten) <= 0);
		do
		{
			cout << "\n nhap vao gioi tinh Nam hoac Nu : ";
			gets(a[i].gioitinh);
			if (strlen(a[i].gioitinh) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].gioitinh) <= 0);
		do
		{
			cout << "\n nhap vao ngay sinh : ";
			cin >> a[i].ngay;
			if (a[i].ngay <= 0 || a[i].ngay >= 31)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (a[i].ngay <= 0 || a[i].ngay >= 31);
		do
		{
			cout << "\n nhap vao thang sinh : ";
			cin >> a[i].thang;
			if (a[i].thang <= 0 || a[i].thang > 12)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].thang <= 0 || a[i].thang > 12));
		do
		{
			cout << "\n nhap vao nam sinh : ";
			cin >> a[i].nam;
			if (a[i].nam <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (a[i].thang <= 0);
		do
		{
			cout << "\n nhap vao diem  mon 1 : ";
			cin >> a[i].diemmon1;
			if (a[i].diemmon1 < 0 || a[i].diemmon1>10)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].diemmon1 < 0 || a[i].diemmon1>10));
		do
		{
			cout << "\n nhap vao diem  mon 2 : ";
			cin >> a[i].diemmon2;
			if (a[i].diemmon2 < 0 || a[i].diemmon2>10)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].diemmon2 < 0 || a[i].diemmon2>10));
		do
		{
			cout << "\n nhap vao diem  mon 3 : ";
			cin >> a[i].diemmon3;
			if (a[i].diemmon3 < 0 || a[i].diemmon3>10)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].diemmon3 < 0 || a[i].diemmon3>10));

		a[i].diemtb = (a[i].diemmon1 + a[i].diemmon2 + a[i].diemmon3) / 3;
		
	}
}
void DSSINHVIEN::luufile()
{
	char Tenfile[25];
	cout << "\nNhap Ten File Can Ghi:";
	fflush(stdin);
	cin >> Tenfile;
	fstream fout(Tenfile, ios::out | ios::binary);
	if (!fout)
	{
		cout << "\nKhong Tao Duoc File Ghi" << Tenfile << endl;
		exit(0);
	}
		for (int i = 0; i < n; i++)
	{
		fout.write((char*)(&a[i]), sizeof(SINHVIEN));
	}
	fout.close();
	cout<<"\nLuu file thanh cong !";
	system("pause");
}
void DSSINHVIEN::Nhap_luufile()
{
	char Tenfile[25];
	cout << "\nNhap Ten File Can Ghi:";
	fflush(stdin);
	cin >> Tenfile;
	fstream fout(Tenfile, ios::out | ios::binary);
	if (!fout)
	{
		cout << "\nKhong Tao Duoc File Ghi" << Tenfile << endl;
		exit(0);
	}
	cout << "\n Nhap vao so sinh vien:" << endl;
	cin >> n;
	a = new SINHVIEN[n];
	for (int i = 0; i < n; i++)
	{
		cout << "\n nhap vao thong tinh sinh vien thu:" << i + 1;
		fflush(stdin);
		do
		{
			cout << "\n nhap vao ma so sinh vien : ";
			gets(a[i].masv);
			if (strlen(a[i].masv) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].masv) <= 0);
		do
		{
			cout << "\n nhap vao ho :";
			gets(a[i].ho);
			if (strlen(a[i].ho) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}

		} while (strlen(a[i].ho) <= 0);
		do
		{
			cout << "\n nhap vao ten lot : ";
			gets(a[i].tenlot);
			if (strlen(a[i].tenlot) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].tenlot) <= 0);
		do
		{
			cout << "\n nhap vao ten : ";
			gets(a[i].ten);
			if (strlen(a[i].ten) <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].ten) <= 0);
		do
		{
			cout << "\n nhap vao gioi tinh Nam hoac Nu : ";
			gets(a[i].gioitinh);
			if (strlen(a[i].gioitinh) <=0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (strlen(a[i].gioitinh) <=0);
		do
		{
			cout << "\n nhap vao ngay sinh : ";
			cin >> a[i].ngay;
			if (a[i].ngay <= 0 || a[i].ngay >= 31)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (a[i].ngay <= 0 || a[i].ngay >= 31);
		do
		{
			cout << "\n nhap vao thang sinh : ";
			cin >> a[i].thang;
			if (a[i].thang <= 0 || a[i].thang > 12)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].thang <= 0 || a[i].thang > 12));
		do
		{
			cout << "\n nhap vao nam sinh : ";
			cin >> a[i].nam;
			if (a[i].nam <= 0)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while (a[i].thang <= 0);
		do
		{
			cout << "\n nhap vao diem  mon 1 : ";
			cin >> a[i].diemmon1;
			if (a[i].diemmon1 < 0 || a[i].diemmon1>10)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].diemmon1 < 0 || a[i].diemmon1>10));
		do
		{
			cout << "\n nhap vao diem  mon 2 : ";
			cin >> a[i].diemmon2;
			if (a[i].diemmon2 < 0 || a[i].diemmon2>10)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
		} while ((a[i].diemmon2 < 0 || a[i].diemmon2>10));
		do
		{
			cout << "\n nhap vao diem  mon 3 : ";
			cin >> a[i].diemmon3;
			if (a[i].diemmon3 < 0 || a[i].diemmon3>10)
			{
				cout << "\n loi !!! Moi nhap lai";
			}
        } while ((a[i].diemmon3 < 0 || a[i].diemmon3>10));

		a[i].diemtb = (a[i].diemmon1 + a[i].diemmon2 + a[i].diemmon3) / 3;
		fout.write((char*)(&a[i]), sizeof(SINHVIEN));
	}
	fout.close();
}
void DSSINHVIEN::Docfile()
{
	char Tenfile[25];
	cout << "Nhap Ten Tap Tin Can Doc:";
	fflush(stdin);
	cin >>  Tenfile;
	SINHVIEN sv;
	SINHVIEN T[n];
	fstream fin(Tenfile, ios::in | ios::binary);
	if (!fin)
	{
		cout << "Khong mo duoc file" << Tenfile << endl;
		exit(1);
	}
	int i = 0;
	cout << setiosflags(ios::showpoint) << setprecision(2);
	cout << "_________________________________________________________________________________________\n";
	cout << "|" << setw(4) << "stt" << setw(8) << "MSV " << "|" << setw(32) << "Ho va ten            " << "|" << setw(8) << "GioiTinh" << "|" << setw(12) << "NgaySinh " << "|" << setw(4) << "Mon1" << " " << setw(4) << "Mon2" << " " << setw(4) << "Mon3" << " " << setw(3) << "dtb" << " " << "|" << endl;
	cout << "_________________________________________________________________________________________\n";
	while (1)
	{
		fin.read((char*)(&sv), sizeof(SINHVIEN));
		T[i]=sv;
		if (!fin)
			break;
		cout << "|" << setw(4) << i + 1 << setw(8) << sv.masv << "|" << setw(10) << sv.ho << " " << setw(10) << sv.tenlot << " " << setw(10) << sv.ten << "|" << setw(8) << sv.gioitinh << "|" << setw(3) << sv.ngay << "/" << setw(3) << sv.thang << "/" << setw(4) << sv.nam << "|" /*<< fixed << setprecision(1)*/ << setw(4) << sv.diemmon1 << " " << setw(4) << sv.diemmon2 << " " << setw(4) << sv.diemmon3 << " " << setw(3) << sv.diemtb << " |" << endl;
		cout << "| " << setw(87) << "|" << endl;
		i++;
	}
	n = i;
	fin.close();
	for(int j=0; j<n;j++)
	a[j]=T[j];
}
void DSSINHVIEN::xuatthongtin()
{
	cout << setiosflags(ios::showpoint) << setprecision(2);
	cout << "__________________________________________________________________________________________\n";
	cout << "|" << setw(4) << "Stt" <<"|"<< setw(8) << "MSV " << "|" << setw(32) << "Ho Va Ten            " << "|" << setw(8) << "GioiTinh" << "|" << setw(12) << "NgaySinh " << "|" << setw(4) << "Mon1"<<"|" << setw(4) <<"Mon2" <<"|"<< setw(4) << "Mon3" <<"|"<< setw(3) << "Dtb"<<" "<< "|" << endl;
	cout << "__________________________________________________________________________________________\n";
	for (int i = 0; i < n; i++)
	{
		cout << "|" << setw(4) << i + 1 <<"|"<< setw(8) << a[i].masv << "|" << setw(10) << a[i].ho << " " << setw(10) << a[i].tenlot << " " << setw(10) << a[i].ten << "|" << setw(8) << a[i].gioitinh << "|" << setw(3) << a[i].ngay << "/" << setw(3) << a[i].thang << "/" << setw(4) << a[i].nam << "|" /*<< fixed << setprecision(1)*/ << setw(4) << a[i].diemmon1 << "|" << setw(4) << a[i].diemmon2 << "|" << setw(4) << a[i].diemmon3 << "|" << setw(3) << a[i].diemtb << " |" << endl;
		cout << "| " << setw(88) << "|" << endl;
	}
}
void DSSINHVIEN::tim_Ten()
{
	int tim = 0;
	char ho[30];
	char tenlot[30];
	char ten[30];
	
	cout << "\nNhap ten sinh vien can tim: ";
	fflush(stdin);
	cout << "\nHo: ";
	gets(ho);
	fflush(stdin);
	cout << "\nTen lot: ";
	gets(tenlot);
	fflush(stdin);
	cout << "\nTen: ";
	gets(ten);
	
	cout << "\n----------Danh sach cac sinh vien duoc tim thay------------" << endl;
	cout << "|" << setw(4) << "Stt" << "|" << setw(8) << "MSV " << "|" << setw(32) << "Ho va ten           " << "|" << setw(8) << "GioiTinh" << "|" << setw(12) << "NgaySinh " << "|" << setw(4) << "Mon1" << "|" << setw(4) << "Mon2" << "|" << setw(4) << "Mon3" << "|" << setw(3) << "Dtb" << " " << "|" << endl;
	cout << "------------------------------------------------------------------------------------------\n";
	for (int i = 0; i<n; ++i)
	{
		if (strcmp(a[i].ho, ho) == 0 && strcmp(a[i].tenlot, tenlot) == 0 && strcmp(a[i].ten, ten) == 0)
		{
			cout << "|" << setw(4) << i + 1 << "|" << setw(8) << a[i].masv << "|" << setw(10) << a[i].ho << " " << setw(10) << a[i].tenlot << " " << setw(10) << a[i].ten << "|" << setw(8) << a[i].gioitinh << "|" << setw(3) << a[i].ngay << "/" << setw(3) << a[i].thang << "/" << setw(4) << a[i].nam << "|" << setprecision(2) << setw(4) << a[i].diemmon1 << "|" << setw(4) << a[i].diemmon2 << "|" << setw(4) << a[i].diemmon3 << "|" << setw(3) << a[i].diemtb << " |" << endl;
			cout << "| " << setw(88) << "|" << endl;
			tim++;
		}
	}
	if (tim == 0)
		cout << "\n khong tim thay";
}
void DSSINHVIEN::Tim_dtb()


{
	int tim = 0;
	float  d1, d2;

	cout << "\nNhap diem trung binh can tim nam trong khoan : ";
	cout << "\n tu diem: ";
	cin >> d1;
	cout << "\n toi diem: ";
	cin >> d2;
	
	cout << "\n----------Danh sach cac sinh vien duoc tim thay------------" << endl;
	cout << "|" << setw(4) << "Stt" << "|" << setw(8) << "MSV " << "|" << setw(32) << "Ho va ten           " << "|" << setw(8) << "GioiTinh" << "|" << setw(12) << "NgaySinh " << "|" << setw(4) << "Mon1" << "|" << setw(4) << "Mon2" << "|" << setw(4) << "Mon3" << "|" << setw(3) << "Dtb" << " " << "|" << endl;
	cout << "------------------------------------------------------------------------------------------\n";
	for (int i = 0; i<n; ++i)
	{
			if((a[i].diemtb ) <= d2 && (a[i].diemtb) >= d1)
		{


				cout << "|" << setw(4) << i + 1 << "|" << setw(8) << a[i].masv << "|" << setw(10) << a[i].ho << " " << setw(10) << a[i].tenlot << " " << setw(10) << a[i].ten << "|" << setw(8) << a[i].gioitinh << "|" << setw(3) << a[i].ngay << "/" << setw(3) << a[i].thang << "/" << setw(4) << a[i].nam << "|" << setprecision(2) << setw(4) << a[i].diemmon1 << "|" << setw(4) << a[i].diemmon2 << "|" << setw(4) << a[i].diemmon3 << "|" << setw(3) << a[i].diemtb << " |" << endl;
				cout << "| " << setw(88) << "|" << endl;
				tim++;
		}
	}
	if (tim == 0)
		cout << "\n khong tim thay";
}
